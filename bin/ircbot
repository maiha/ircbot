#!/usr/bin/env ruby
# clear ARGV for Irb

require 'ircbot'

$KCODE = 'e'

# Sync
STDOUT.sync = true
STDERR.sync = true

debug  = nil
config = nil
cpi    = Pathname(Dir.getwd) + "cpi"

while (arg = ARGV.shift)
  case arg
  when /^-d$/		; debug  = true
  when /^-f$/		; config = ARGV.shift
  when /^-c$/		; cpi    = ARGV.shift
  else
    puts "invalid argument: `#{arg}'"
    exit
  end
end

unless config
  raise "Specify your config file\nusage: #{$0} -f config/xxx.dat"
end

# set cpi directory
Ircbot.push_path :cpi, cpi, "**/*.cpi"


module Ircbot
  class Kicker < Ircbot::ReplyClient
    rescue_from(SocketError) {
      raise Ircbot::Recover, 30.minutes
    }

    rescue_from(Errno::EPIPE, Errno::ECONNRESET, Errno::ETIMEDOUT, IRC::AbnormalTerminated) {
      raise Ircbot::Recover, 300.minutes
    }
  end
end
      

irc = Ircbot::ReplyClient.read_config(config, debug)
irc.start
puts "Bye"
